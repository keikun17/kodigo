# Action Cable 

## Minimum setup required to get action cable working on Rails

### Edit `config/cable.yml` (file generated by new Rails 5 app generator)

This is the configuration file for your actioncable data. 

You might want to edit it to make it look like this :

```
# app/config/redis/cable.yml
development: &development
  :url: redis://localhost:6379
  :host: localhost
  :port: 6379
  :timeout: 1
  :inline: true
test: *development
```



### 2. Add `//=require cable` to the javascript manifest

this will load `app/javascripts/cable.coffee` or `app/javascripts/cable.js` to your application.
All js files that are has cable js functions and actions should be loaded from here.
This file is the manifest for action cable js files

```
# app/assets/javascripts/application.js
//= require jquery
//= require jquery_ujs
//= require turbolinks
//= require cable
```


### 3. Edit `app/channels/application_cable/connection`

This file **ONLY** deals with authorization and authentication of cable connections. No other app logic aside from fetching
the identifier (most of the time the 'user') with the token it receive

A configuration that uses the user as the identifier looks like this

```
module ApplicationCable
  class Connection < ActionCable::Connection::Base
    identified_by :current_user

    def connect
      self.current_user = find_verified_user
      logger.add_tags current_user.name
    end

    def disconnect
      # Any cleanup work needed when the cable connection is cut.
    end

    protected
      def find_verified_user
        if current_user = User.find_by_identity cookies.signed[:identity_id]
          current_user
        else
          reject_unauthorized_connection
        end
      end
  end
end
```
